---
title: "Geographical"
output: html_notebook
---


```{r Setup}
library(tidyverse)
library(sf)
library(raster)
library(leaflet)
library(ggspatial)
library(rnaturalearth)
library(rnaturalearthdata)
library(maps)
library(osrm)
```

```{r}
data <- read_rds("../data/data_aggregated.rds")
head(data)
unique(data$PR_NAME)
```

#select and filter
```{r}
data_geo <- data %>% 
  #filter(`PR_NAME` %in% c("Western Cape")) %>% 
  dplyr::select(`timestamp`, `vehicleid`, `event_description`, `coordinate_latitude`, `coordinate_longitude`)
  

data_geo
```

# convert to spatial dataframe
```{r}
data_spatial <- st_as_sf(
  data_geo,
  coords = c("coordinate_longitude","coordinate_latitude"),
  crs = 4326
)
```

# from points to lines
```{r}
data_spatial <- data_spatial %>%
  group_by(vehicleid) %>%
  arrange(timestamp) %>% 
  summarise(do_union = F)

routes_spatial <- data_spatial %>% 
  st_cast(to = "LINESTRING")

routes_spatial = routes_spatial %>% 
  mutate(distance = st_length(.))
```

# initial plotting
```{r}

world <- ne_countries(country = "South Africa", returnclass = "sf") %>% 
  st_set_crs(4326)
class(world)

data_spatial %>%   
  ggplot()+
  geom_sf(color=data_geo$vehicleid,size = 0.05)+
  #geom_sf(data = world)+
  labs(title = "driving activity of ID 104804470")+
  xlab("Longitude")+
  ylab("Lattitude") +
  ggspatial::annotation_north_arrow(location = "br")+
  ggspatial::annotation_scale(location = "bl") 
  
  
```

# country map
```{r}
ggplot() +
  geom_sf(data=world, lwd=0.2) +
  geom_sf(data=routes_spatial, color =vehicleid)

 # additional code that doesnt seem to work
 # d <- world.cities
 # 
 # d <- d[which(d$country.etc == "South Africa"),]
 # 
 # d <- st_as_sf(d,coords = c("long","lat"))
 # 
 # st_crs(d) <- 4326
 # 
 # leaflet(d) %>%
 #   addTiles() 

#geom_sf(data_geo, aes(coordinate_longitude, coordinate_lattitude),color=data_geo$vehicleid,size = 0.05)
  
  

```

